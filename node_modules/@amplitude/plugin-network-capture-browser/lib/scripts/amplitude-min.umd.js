!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).amplitude={})}(this,function(e){"use strict";var t=function(){return t=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},t.apply(this,arguments)};function r(e,t,r,n){return new(r||(r=Promise))(function(o,i){function u(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(u,s)}a((n=n.apply(e,t||[])).next())})}function n(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},u=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return u.next=s(0),u.throw=s(1),u.return=s(2),"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function s(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function o(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function i(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),u=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)u.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return u}function u(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var s=["access-control-allow-origin","access-control-allow-credentials","access-control-expose-headers","access-control-max-age","access-control-allow-methods","access-control-allow-headers","accept-patch","accept-ranges","age","allow","alt-svc","cache-control","connection","content-disposition","content-encoding","content-language","content-length","content-location","content-md5","content-range","content-type","date","delta-base","etag","expires","im","last-modified","link","location","permanent","p3p","pragma","proxy-authenticate","public-key-pins","retry-after","server","status","strict-transport-security","trailer","transfer-encoding","tk","upgrade","vary","via","warning","www-authenticate","x-b3-traceid","x-frame-options"],a=["authorization","cookie","set-cookie"],l=function(){var e="ampIntegrationContext";return"undefined"!=typeof globalThis&&void 0!==globalThis[e]?globalThis[e]:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:void 0},c=u([],i(Array(256).keys()),!1).map(function(e){return e.toString(16).padStart(2,"0")}),f=function(e){var t,r=l();if(!(null===(t=null==r?void 0:r.crypto)||void 0===t?void 0:t.getRandomValues))return function(e){return e?(e^16*Math.random()>>e/4).toString(16):(String(1e7)+String(-1e3)+String(-4e3)+String(-8e3)+String(-1e11)).replace(/[018]/g,f)}(e);var n=r.crypto.getRandomValues(new Uint8Array(16));return n[6]=15&n[6]|64,n[8]=63&n[8]|128,u([],i(n.entries()),!1).map(function(e){var t=i(e,2),r=t[0],n=t[1];return[4,6,8,10].includes(r)?"-".concat(c[n]):c[n]}).join("")};function d(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||null==e}function p(e,t,r){e&&h({json:e,allowlist:t.map(v),excludelist:r.map(v),ancestors:[]})}function h(e){var t,r,n=e.json,s=e.targetObject,a=e.allowlist,l=e.excludelist,c=e.ancestors,f=e.parentObject,p=e.targetKey;s||(s=n);var v=Object.keys(s);try{for(var y=o(v),g=y.next();!g.done;g=y.next()){var m=g.value,w=u(u([],i(c),!1),[m],!1);d(s[m])?b(w,a)&&!b(w,l)||delete s[m]:h({json:n,targetObject:s[m],allowlist:a,excludelist:l,ancestors:w,parentObject:s,targetKey:m})}}catch(e){t={error:e}}finally{try{g&&!g.done&&(r=y.return)&&r.call(y)}finally{if(t)throw t.error}}0===Object.keys(s).length&&f&&p&&delete f[p]}function v(e){return e.startsWith("/")&&(e=e.slice(1)),e.split("/").map(function(e){return e.replace(/~0/g,"~").replace(/~1/g,"/")})}function y(e,t,r,n){if(void 0===r&&(r=0),void 0===n&&(n=0),n===t.length)return r===e.length;if(r===e.length){for(;n<t.length&&"**"===t[n];)n++;return n===t.length}var o=t[n];if("**"===o){if(n+1===t.length)return!0;for(var i=r;i<=e.length;i++)if(y(e,t,i,n+1))return!0;return!1}return("*"===o||o===e[r])&&y(e,t,r+1,n+1)}function b(e,t){return t.some(function(t){return y(e,t)})}var g=function(){function e(e){this.request=e}return e.prototype.headers=function(e){var t,r;void 0===e&&(e=[]);var n=this.request.headers,u={};if(Array.isArray(n))n.forEach(function(e){var t=i(e,2),r=t[0],n=t[1];u[r]=n});else if(n instanceof Headers)n.forEach(function(e,t){u[t]=e});else if("object"==typeof n&&null!==n)try{for(var s=o(Object.entries(n)),a=s.next();!a.done;a=s.next()){var l=i(a.value,2),c=l[0],f=l[1];u[c]=f}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return E(u,{allow:e})},Object.defineProperty(e.prototype,"bodySize",{get:function(){if("number"==typeof this._bodySize)return this._bodySize;var e=l();if(null==e?void 0:e.TextEncoder){var t=this.request.body;return this._bodySize=w(t,100),this._bodySize}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"method",{get:function(){return this.request.method},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"body",{get:function(){return"string"==typeof this.request.body?this.request.body:null},enumerable:!1,configurable:!0}),e.prototype.json=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=[]),r(this,void 0,void 0,function(){return n(this,function(r){return 0===e.length?[2,null]:[2,T(this.body,e,t)]})})},e}(),m=function(){function e(e,t){this.bodyRaw=e,this.requestHeaders=t}return e.prototype.headers=function(e){return void 0===e&&(e=[]),E(this.requestHeaders,{allow:e})},Object.defineProperty(e.prototype,"bodySize",{get:function(){return w(this.bodyRaw,100)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"body",{get:function(){return"string"==typeof this.bodyRaw?this.bodyRaw:null},enumerable:!1,configurable:!0}),e.prototype.json=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=[]),r(this,void 0,void 0,function(){return n(this,function(r){return 0===e.length?[2,null]:[2,T(this.body,e,t)]})})},e}();function w(e,t){var r,n,u,s=l(),a=null==s?void 0:s.TextEncoder;if(a){var c;if("string"==typeof e)c=e,u=(new a).encode(c).length;else if(e instanceof Blob)u=(c=e).size;else if(e instanceof URLSearchParams)c=e,u=(new a).encode(c.toString()).length;else if(ArrayBuffer.isView(e))u=(c=e).byteLength;else if(e instanceof ArrayBuffer)u=(c=e).byteLength;else if(e instanceof FormData){var f=e,d=0,p=0;try{for(var h=o(f.entries()),v=h.next();!v.done;v=h.next()){var y=i(v.value,2),b=y[0],g=y[1];if(d+=b.length,"string"==typeof g)d+=(new a).encode(g).length;else{if(!(g instanceof Blob))return;d+=g.size}if(++p>=t)return}}catch(e){r={error:e}}finally{try{v&&!v.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}u=d}else if(e instanceof ReadableStream)return void(c=e);return u}}var S,x=function(){function e(e){this.response=e}return e.prototype.headers=function(e){var t;if(void 0===e&&(e=[]),this.response.headers instanceof Headers){var r=this.response.headers,n={};return null===(t=null==r?void 0:r.forEach)||void 0===t||t.call(r,function(e,t){n[t]=e}),E(n,{allow:e})}},Object.defineProperty(e.prototype,"bodySize",{get:function(){var e,t;if(void 0!==this._bodySize)return this._bodySize;var r=null===(t=null===(e=this.response.headers)||void 0===e?void 0:e.get)||void 0===t?void 0:t.call(e,"content-length"),n=r?parseInt(r,10):void 0;return this._bodySize=n,n},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this.response.status},enumerable:!1,configurable:!0}),e.prototype.text=function(){return r(this,void 0,void 0,function(){var e,t;return n(this,function(r){switch(r.label){case 0:this.clonedResponse||(this.clonedResponse=this.response.clone()),r.label=1;case 1:return r.trys.push([1,3,,4]),e=this.clonedResponse.text(),t=new Promise(function(e){return setTimeout(function(){return e(null)},500)}),[4,Promise.race([e,t])];case 2:return[2,r.sent()];case 3:return r.sent(),[2,null];case 4:return[2]}})})},e.prototype.json=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=[]),r(this,void 0,void 0,function(){return n(this,function(r){switch(r.label){case 0:return 0===e.length?[2,null]:[4,this.text()];case 1:return[2,T(r.sent(),e,t)]}})})},e}(),q=function(){function e(e,t,r,n){this.statusCode=e,this.headersString=t,this.size=r,this.getJson=n}return Object.defineProperty(e.prototype,"bodySize",{get:function(){return this.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this.statusCode},enumerable:!1,configurable:!0}),e.prototype.headers=function(e){var t,r;if(void 0===e&&(e=[]),!this.headersString)return{};var n={},u=this.headersString.split("\r\n");try{for(var s=o(u),a=s.next();!a.done;a=s.next()){var l=i(a.value.split(": "),2),c=l[0],f=l[1];c&&f&&(n[c]=f)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return E(n,{allow:e})},e.prototype.json=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=[]),r(this,void 0,void 0,function(){var r;return n(this,function(n){return 0===e.length?[2,null]:(r=this.getJson())?(p(r,e,t),[2,r]):[2,null]})})},e}();function T(e,t,r){if(!e)return null;try{var n=JSON.parse(e);return p(n,t,r),n}catch(e){return null}}!function(e){e.REDACT="redact",e.REMOVE="remove"}(S||(S={}));var O="[REDACTED]",E=function(e,t){var r,n,s=t.allow,l=void 0===s?[]:s,c=t.strategy,f=void 0===c?S.REMOVE:c,d=u([],i(a),!1),p={},h=function(t){var r=t.toLowerCase();d.find(function(e){return e.toLowerCase()===r})?f===S.REDACT&&(p[t]=O):l.find(function(e){return e.toLowerCase()===r})?p[t]=e[t]:f===S.REDACT&&(p[t]=O)};try{for(var v=o(Object.keys(e)),y=v.next();!y.done;y=v.next()){h(y.value)}}catch(e){r={error:e}}finally{try{y&&!y.done&&(n=v.return)&&n.call(v)}finally{if(r)throw r.error}}return p},R=function(){function e(e,t,r,n,o,i,u,s,a,l,c){void 0===u&&(u=0),this.type=e,this.method=t,this.timestamp=r,this.startTime=n,this.url=o,this.requestWrapper=i,this.status=u,this.duration=s,this.responseWrapper=a,this.error=l,this.endTime=c}return e.prototype.toSerializable=function(){var e,t,r,n,o={type:this.type,method:this.method,url:this.url,timestamp:this.timestamp,status:this.status,duration:this.duration,error:this.error,startTime:this.startTime,endTime:this.endTime,requestHeaders:null===(e=this.requestWrapper)||void 0===e?void 0:e.headers(u([],i(s),!1)),requestBodySize:null===(t=this.requestWrapper)||void 0===t?void 0:t.bodySize,responseHeaders:null===(r=this.responseWrapper)||void 0===r?void 0:r.headers(u([],i(s),!1)),responseBodySize:null===(n=this.responseWrapper)||void 0===n?void 0:n.bodySize};return Object.fromEntries(Object.entries(o).filter(function(e){var t=i(e,2);return t[0],void 0!==t[1]}))},e}();var j=function(e,t){void 0===t&&(t=f()),this.callback=e,this.id=t},k=function(){function e(t){this.eventCallbacks=new Map,this.isObserving=!1,this.logger=t;var r=l();e.isSupported()&&(this.globalScope=r)}return e.isSupported=function(){var e=l();return!!e&&!!e.fetch},e.prototype.subscribe=function(e,t){var r,n,o,i,u,s,a,l,c,f;if(this.logger||(this.logger=t),this.eventCallbacks.set(e.id,e),!this.isObserving){var d=null===(o=null===(n=null===(r=this.globalScope)||void 0===r?void 0:r.XMLHttpRequest)||void 0===n?void 0:n.prototype)||void 0===o?void 0:o.open,p=null===(s=null===(u=null===(i=this.globalScope)||void 0===i?void 0:i.XMLHttpRequest)||void 0===u?void 0:u.prototype)||void 0===s?void 0:s.send,h=null===(c=null===(l=null===(a=this.globalScope)||void 0===a?void 0:a.XMLHttpRequest)||void 0===l?void 0:l.prototype)||void 0===c?void 0:c.setRequestHeader;d&&p&&h&&this.observeXhr(d,p,h);var v=null===(f=this.globalScope)||void 0===f?void 0:f.fetch;v&&this.observeFetch(v),this.isObserving=!0}},e.prototype.unsubscribe=function(e){this.eventCallbacks.delete(e.id)},e.prototype.triggerEventCallbacks=function(e){var t=this;this.eventCallbacks.forEach(function(r){var n;try{r.callback(e)}catch(e){null===(n=t.logger)||void 0===n||n.debug("an unexpected error occurred while triggering event callbacks",e)}})},e.prototype.handleNetworkRequestEvent=function(e,t,r,n,o,i,u){var s;if(void 0!==i&&void 0!==u){var a,l,c,f="GET";if(!function(e){return"object"==typeof e&&null!==e&&"url"in e&&"method"in e}(t)?a=null===(s=null==t?void 0:t.toString)||void 0===s?void 0:s.call(t):(a=t.url,f=t.method),a)try{var d=new URL(a);a="".concat(d.protocol,"//").concat(d.host).concat(d.pathname).concat(d.search).concat(d.hash)}catch(e){}f=(null==r?void 0:r.method)||f,n&&(l=n.status),o&&(c={name:o.name||"UnknownError",message:o.message||"An unknown error occurred"},l=0);var p=Math.floor(performance.now()-u),h=Math.floor(i+p),v=new R(e,f,i,i,a,r,l,p,n,c,h);this.triggerEventCallbacks(v)}},e.prototype.getTimestamps=function(){var e,t;return{startTime:null===(e=Date.now)||void 0===e?void 0:e.call(Date),durationStart:null===(t=null===performance||void 0===performance?void 0:performance.now)||void 0===t?void 0:t.call(performance)}},e.prototype.observeFetch=function(e){var t=this;this.globalScope&&e&&(this.globalScope.fetch=function(o,i){return r(t,void 0,void 0,function(){var t,r,u,s,a,l;return n(this,function(n){switch(n.label){case 0:try{t=this.getTimestamps()}catch(e){null===(a=this.logger)||void 0===a||a.debug("an unexpected error occurred while retrieving timestamps",e)}n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e(o,i)];case 2:return r=n.sent(),[3,4];case 3:return s=n.sent(),u=s,[3,4];case 4:try{this.handleNetworkRequestEvent("fetch",o,i?new g(i):void 0,r?new x(r):void 0,u,null==t?void 0:t.startTime,null==t?void 0:t.durationStart)}catch(e){null===(l=this.logger)||void 0===l||l.debug("an unexpected error occurred while handling fetch",e)}if(r)return[2,r];throw u}})})})},e.createXhrJsonParser=function(e,t){return function(){var r,n;try{if("json"===e.responseType){if(null===(r=t.globalScope)||void 0===r?void 0:r.structuredClone)return t.globalScope.structuredClone(e.response)}else if(["text",""].includes(e.responseType))return JSON.parse(e.responseText)}catch(r){return r instanceof Error&&"InvalidStateError"===r.name&&(null===(n=t.logger)||void 0===n||n.error("unexpected error when retrieving responseText. responseType='".concat(e.responseType,"'"))),null}return null}},e.prototype.observeXhr=function(r,n,o){if(this.globalScope&&r&&n){var u=this.globalScope.XMLHttpRequest.prototype,s=this;u.open=function(){for(var e,n,o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];var a=i(o,2),l=a[0],c=a[1];try{this.$$AmplitudeAnalyticsEvent=t({method:l,url:null===(e=null==c?void 0:c.toString)||void 0===e?void 0:e.call(c),headers:{}},s.getTimestamps())}catch(e){null===(n=s.logger)||void 0===n||n.error("an unexpected error occurred while calling xhr open",e)}return r.apply(this,o)},u.send=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var o=this,i=e.createXhrJsonParser(this,s),u=t[0],a=o.$$AmplitudeAnalyticsEvent;return o.addEventListener("loadend",function(){var e;try{var t=o.getAllResponseHeaders(),r=o.getResponseHeader("content-length"),n=new q(o.status,t,r?parseInt(r,10):void 0,i),l=o.$$AmplitudeAnalyticsEvent.headers,c=new m(u,l);a.status=o.status,s.handleNetworkRequestEvent("xhr",{url:a.url,method:a.method},c,n,void 0,a.startTime,a.durationStart)}catch(t){null===(e=s.logger)||void 0===e||e.error("an unexpected error occurred while handling xhr send",t)}}),n.apply(o,t)},u.setRequestHeader=function(e,t){var r;try{this.$$AmplitudeAnalyticsEvent.headers[e]=t}catch(e){null===(r=s.logger)||void 0===r||r.error("an unexpected error occurred while calling xhr setRequestHeader",e)}o.apply(this,[e,t])}}},e}(),A=new k;function _(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return z(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return z(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function P(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function C(e,t,r){return t&&P(e.prototype,t),r&&P(e,r),e}var H=function(){return"function"==typeof Symbol},B=function(e){return H()&&Boolean(Symbol[e])},W=function(e){return B(e)?Symbol[e]:"@@"+e};H()&&!B("observable")&&(Symbol.observable=Symbol("observable"));var L=W("iterator"),J=W("observable"),M=W("species");function N(e,t){var r=e[t];if(null!=r){if("function"!=typeof r)throw new TypeError(r+" is not a function");return r}}function $(e){var t=e.constructor;return void 0!==t&&null===(t=t[M])&&(t=void 0),void 0!==t?t:Y}function D(e){return e instanceof Y}function I(e){I.log?I.log(e):setTimeout(function(){throw e})}function U(e){Promise.resolve().then(function(){try{e()}catch(e){I(e)}})}function X(e){var t=e._cleanup;if(void 0!==t&&(e._cleanup=void 0,t))try{if("function"==typeof t)t();else{var r=N(t,"unsubscribe");r&&r.call(t)}}catch(e){I(e)}}function F(e){e._observer=void 0,e._queue=void 0,e._state="closed"}function V(e,t,r){e._state="running";var n=e._observer;try{var o=N(n,t);switch(t){case"next":o&&o.call(n,r);break;case"error":if(F(e),!o)throw r;o.call(n,r);break;case"complete":F(e),o&&o.call(n)}}catch(e){I(e)}"closed"===e._state?X(e):"running"===e._state&&(e._state="ready")}function Q(e,t,r){if("closed"!==e._state){if("buffering"!==e._state)return"ready"!==e._state?(e._state="buffering",e._queue=[{type:t,value:r}],void U(function(){return function(e){var t=e._queue;if(t){e._queue=void 0,e._state="ready";for(var r=0;r<t.length&&(V(e,t[r].type,t[r].value),"closed"!==e._state);++r);}}(e)})):void V(e,t,r);e._queue.push({type:t,value:r})}}var G=function(){function e(e,t){this._cleanup=void 0,this._observer=e,this._queue=void 0,this._state="initializing";var r=new K(this);try{this._cleanup=t.call(void 0,r)}catch(e){r.error(e)}"initializing"===this._state&&(this._state="ready")}return e.prototype.unsubscribe=function(){"closed"!==this._state&&(F(this),X(this))},C(e,[{key:"closed",get:function(){return"closed"===this._state}}]),e}(),K=function(){function e(e){this._subscription=e}var t=e.prototype;return t.next=function(e){Q(this._subscription,"next",e)},t.error=function(e){Q(this._subscription,"error",e)},t.complete=function(){Q(this._subscription,"complete")},C(e,[{key:"closed",get:function(){return"closed"===this._subscription._state}}]),e}(),Y=function(){function e(t){if(!(this instanceof e))throw new TypeError("Observable cannot be called as a function");if("function"!=typeof t)throw new TypeError("Observable initializer must be a function");this._subscriber=t}var t=e.prototype;return t.subscribe=function(e){return"object"==typeof e&&null!==e||(e={next:e,error:arguments[1],complete:arguments[2]}),new G(e,this._subscriber)},t.forEach=function(e){var t=this;return new Promise(function(r,n){if("function"==typeof e)var o=t.subscribe({next:function(t){try{e(t,i)}catch(e){n(e),o.unsubscribe()}},error:n,complete:r});else n(new TypeError(e+" is not a function"));function i(){o.unsubscribe(),r()}})},t.map=function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new($(this))(function(r){return t.subscribe({next:function(t){try{t=e(t)}catch(e){return r.error(e)}r.next(t)},error:function(e){r.error(e)},complete:function(){r.complete()}})})},t.filter=function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new($(this))(function(r){return t.subscribe({next:function(t){try{if(!e(t))return}catch(e){return r.error(e)}r.next(t)},error:function(e){r.error(e)},complete:function(){r.complete()}})})},t.reduce=function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var r=$(this),n=arguments.length>1,o=!1,i=arguments[1];return new r(function(r){return t.subscribe({next:function(t){var u=!o;if(o=!0,!u||n)try{i=e(i,t)}catch(e){return r.error(e)}else i=t},error:function(e){r.error(e)},complete:function(){if(!o&&!n)return r.error(new TypeError("Cannot reduce an empty sequence"));r.next(i),r.complete()}})})},t.concat=function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var o=$(this);return new o(function(t){var n,i=0;return function e(u){n=u.subscribe({next:function(e){t.next(e)},error:function(e){t.error(e)},complete:function(){i===r.length?(n=void 0,t.complete()):e(o.from(r[i++]))}})}(e),function(){n&&(n.unsubscribe(),n=void 0)}})},t.flatMap=function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var r=$(this);return new r(function(n){var o=[],i=t.subscribe({next:function(t){if(e)try{t=e(t)}catch(e){return n.error(e)}var i=r.from(t).subscribe({next:function(e){n.next(e)},error:function(e){n.error(e)},complete:function(){var e=o.indexOf(i);e>=0&&o.splice(e,1),u()}});o.push(i)},error:function(e){n.error(e)},complete:function(){u()}});function u(){i.closed&&0===o.length&&n.complete()}return function(){o.forEach(function(e){return e.unsubscribe()}),i.unsubscribe()}})},t[J]=function(){return this},e.from=function(t){var r="function"==typeof this?this:e;if(null==t)throw new TypeError(t+" is not an object");var n=N(t,J);if(n){var o=n.call(t);if(Object(o)!==o)throw new TypeError(o+" is not an object");return D(o)&&o.constructor===r?o:new r(function(e){return o.subscribe(e)})}if(B("iterator")&&(n=N(t,L)))return new r(function(e){U(function(){if(!e.closed){for(var r,o=_(n.call(t));!(r=o()).done;){var i=r.value;if(e.next(i),e.closed)return}e.complete()}})});if(Array.isArray(t))return new r(function(e){U(function(){if(!e.closed){for(var r=0;r<t.length;++r)if(e.next(t[r]),e.closed)return;e.complete()}})});throw new TypeError(t+" is not observable")},e.of=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return new("function"==typeof this?this:e)(function(e){U(function(){if(!e.closed){for(var t=0;t<r.length;++t)if(e.next(r[t]),e.closed)return;e.complete()}})})},C(e,null,[{key:M,get:function(){return this}}]),e}();H()&&Object.defineProperty(Y,Symbol("extensions"),{value:{symbol:J,hostReportError:I},configurable:!0});var Z,ee,te="[Amplitude] Network Request",re="500-599";function ne(e,t){var r="^"+t.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".*")+"$";return new RegExp(r).test(e)}function oe(e,t){var r,n,u=t.split(",");try{for(var s=o(u),a=s.next();!a.done;a=s.next()){var l=i(a.value.split("-").map(Number),2),c=l[0],f=l[1];if(e===c&&void 0===f)return!0;if(e>=c&&e<=f)return!0}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return!1}function ie(e){var t;if(e)try{var r=null===(t=l())||void 0===t?void 0:t.location.href,n=new URL(e,r),o=n.searchParams.toString(),i=n.hash.replace("#",""),u=n.href,s=n.host;return n.hash="",n.search="",{query:o,fragment:i,href:u,hrefWithoutQueryOrHash:n.href,host:s}}catch(e){return}}function ue(e){if("object"==typeof e&&null!==e){if(0!==e.length)return e}else{if(e)return u([],i(s),!1);if(void 0===e){return}}}function se(e){var t,r;return!(null===(t=null==e?void 0:e.allowlist)||void 0===t?void 0:t.length)&&!(null===(r=null==e?void 0:e.blocklist)||void 0===r?void 0:r.length)}function ae(e,t){var r;void 0===t&&(t={});var n=ie(e.url);if(!n)return!1;var o,s=n.host;if(!1!==t.ignoreAmplitudeRequests&&(ne(s,"*.amplitude.com")||ne(s,"amplitude.com")))return!1;if(null===(r=t.ignoreHosts)||void 0===r?void 0:r.find(function(e){return ne(s,e)}))return!1;if(!t.captureRules&&void 0!==e.status&&!oe(e.status,re))return!1;if(t.captureRules&&(u([],i(t.captureRules),!1).reverse().find(function(t){if(o=function(e,t,r,n,o){if((!e.hosts||e.hosts.find(function(e){return ne(t,e)}))&&(!n||!e.urls||function(e,t){return!t||!t.length||t.some(function(t){return"string"==typeof t?e===t:e.match(t)})}(n,e.urls))&&(!o||!e.methods||e.methods.find(function(e){return o.toLowerCase()===e.toLowerCase()||"*"===e})))return!((r||0===r)&&!oe(r,e.statusCodeRange||re))}(t,s,e.status,e.url,e.method),o){var r=ue(t.responseHeaders);if(e.responseWrapper&&r){var n=e.responseWrapper.headers(r);n&&(e.responseHeaders=n)}var i=ue(t.requestHeaders);if(e.requestWrapper&&i){var u=e.requestWrapper.headers(i);u&&(e.requestHeaders=u)}e.responseWrapper&&t.responseBody&&!se(t.responseBody)&&(e.responseBodyJson=e.responseWrapper.json(t.responseBody.allowlist,t.responseBody.blocklist)),e.requestWrapper&&t.requestBody&&!se(t.requestBody)&&(e.requestBodyJson=e.requestWrapper.json(t.requestBody.allowlist,t.requestBody.blocklist))}return void 0!==o}),!o))return!1;return!e.requestWrapper||!function(e,t){if(e.includes("amplitude.com"))try{var r=t.body;if("string"!=typeof r)return!1;if(JSON.parse(r).events.find(function(e){return e.event_type===te}))return!0}catch(e){}return!1}(s,e.requestWrapper)}function le(e){var t=e.allObservables,o=e.networkTrackingOptions,u=e.amplitude,s=e.loggerProvider;return t.networkObservable.filter(function(e){return ae(e.event,o)}).subscribe(function(e){var t,o,a,l=e.event,c=ie(l.url);if(c){var f=null===(o=l.responseWrapper)||void 0===o?void 0:o.bodySize,d=null===(a=l.requestWrapper)||void 0===a?void 0:a.bodySize;!function(e,t,o,u){r(this,void 0,void 0,function(){var r,s,a;return n(this,function(n){switch(n.label){case 0:return t.requestBodyJson||t.responseBodyJson?[4,Promise.all([t.requestBodyJson,t.responseBodyJson])]:[3,2];case 1:if(r=i.apply(void 0,[n.sent(),2]),s=r[0],a=r[1],s)try{e["[Amplitude] Request Body"]=JSON.stringify(s)}catch(e){null==u||u.debug("Failed to stringify request body",e)}if(a)try{e["[Amplitude] Response Body"]=JSON.stringify(a)}catch(e){null==u||u.debug("Failed to stringify response body")}n.label=2;case 2:return null==o||o.track(te,e),[2]}})})}(((t={})["[Amplitude] URL"]=c.hrefWithoutQueryOrHash,t["[Amplitude] URL Query"]=c.query,t["[Amplitude] URL Fragment"]=c.fragment,t["[Amplitude] Request Method"]=l.method,t["[Amplitude] Status Code"]=l.status,t["[Amplitude] Start Time"]=l.startTime,t["[Amplitude] Completion Time"]=l.endTime,t["[Amplitude] Duration"]=l.duration,t["[Amplitude] Request Body Size"]=d,t["[Amplitude] Response Body Size"]=f,t["[Amplitude] Request Type"]=l.type,t["[Amplitude] Request Headers"]=l.requestHeaders,t["[Amplitude] Response Headers"]=l.responseHeaders,t),l,u,s)}})}!function(e){e.NetworkObservable="networkObservable"}(Z||(Z={}));var ce=function(e){void 0===e&&(e={});var t,o="@amplitude/plugin-network-capture-browser",i=function(){var e,r=new Y(function(e){var r=new j(function(t){var r=function(e,t){return{event:e,timestamp:Date.now(),type:t}}(t,"network");e.next(r)});return A.subscribe(r,t),function(){A.unsubscribe(r)}});return(e={})[Z.NetworkObservable]=r,e};return{name:o,type:"enrichment",setup:function(u,s){return r(void 0,void 0,void 0,function(){var r;return n(this,function(n){return"undefined"==typeof document||(r=i(),t=null==u?void 0:u.loggerProvider,ee=le({allObservables:r,networkTrackingOptions:e,amplitude:s,loggerProvider:t}),null==t||t.log("".concat(o," has been successfully added."))),[2]})})},execute:function(e){return r(void 0,void 0,void 0,function(){return n(this,function(t){return[2,e]})})},teardown:function(){return r(void 0,void 0,void 0,function(){return n(this,function(e){return ee.unsubscribe(),[2]})})}}};e.networkCapturePlugin=ce,e.plugin=ce,Object.defineProperty(e,"__esModule",{value:!0})});
