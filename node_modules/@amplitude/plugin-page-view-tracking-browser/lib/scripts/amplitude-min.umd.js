!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).amplitude={})}(this,function(e){"use strict";var t,n,r=function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};function i(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function u(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,u)}c((r=r.apply(e,t||[])).next())})}function o(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=u(0),a.throw=u(1),a.return=u(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&u[0]?r.return:u[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,u[1])).done)return i;switch(r=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){o.label=u[1];break}if(6===u[0]&&o.label<i[1]){o.label=i[1],i=u;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(u);break}i[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],r=0}finally{n=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}function a(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function u(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError,function(e){e.SET="$set",e.SET_ONCE="$setOnce",e.ADD="$add",e.APPEND="$append",e.PREPEND="$prepend",e.REMOVE="$remove",e.PREINSERT="$preInsert",e.POSTINSERT="$postInsert",e.UNSET="$unset",e.CLEAR_ALL="$clearAll"}(t||(t={})),function(e){e.IDENTIFY="$identify",e.GROUP_IDENTIFY="$groupidentify",e.REVENUE="revenue_amount"}(n||(n={}));var c="dclid",l="fbclid",d="gbraid",f="gclid",p="ko_click_id",s="li_fat_id",v="msclkid",y="rdt_cid",m="ttclid",g="twclid",h="wbraid",b={utm_campaign:void 0,utm_content:void 0,utm_id:void 0,utm_medium:void 0,utm_source:void 0,utm_term:void 0,referrer:void 0,referring_domain:void 0,dclid:void 0,gbraid:void 0,gclid:void 0,fbclid:void 0,ko_click_id:void 0,li_fat_id:void 0,msclkid:void 0,rdt_cid:void 0,ttclid:void 0,twclid:void 0,wbraid:void 0},_=function(){var e="ampIntegrationContext";return"undefined"!=typeof globalThis&&void 0!==globalThis[e]?globalThis[e]:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:void 0},w=function(){var e,t=_();return(null===(e=null==t?void 0:t.location)||void 0===e?void 0:e.search)?t.location.search.substring(1).split("&").filter(Boolean).reduce(function(e,t){var n=t.split("=",2),r=E(n[0]),i=E(n[1]);return i?(e[r]=i,e):e},{}):{}},E=function(e){void 0===e&&(e="");try{return decodeURIComponent(e)}catch(e){return""}},k=function(){function e(){}return e.prototype.parse=function(){return i(this,void 0,void 0,function(){return o(this,function(e){return[2,r(r(r(r({},b),this.getUtmParam()),this.getReferrer()),this.getClickIds())]})})},e.prototype.getUtmParam=function(){var e=w();return{utm_campaign:e.utm_campaign,utm_content:e.utm_content,utm_id:e.utm_id,utm_medium:e.utm_medium,utm_source:e.utm_source,utm_term:e.utm_term}},e.prototype.getReferrer=function(){var e,t,n={referrer:void 0,referring_domain:void 0};try{n.referrer=document.referrer||void 0,n.referring_domain=null!==(t=null===(e=n.referrer)||void 0===e?void 0:e.split("/")[2])&&void 0!==t?t:void 0}catch(e){}return n},e.prototype.getClickIds=function(){var e,t=w();return(e={})[c]=t[c],e[l]=t[l],e[d]=t[d],e[f]=t[f],e[p]=t[p],e[s]=t[s],e[v]=t[v],e[y]=t[y],e[m]=t[m],e[g]=t[g],e[h]=t[h],e},e}(),T="*****",P=/\b(?:\d[ -]*?){13,16}\b/,S=/(\d{3}-?\d{2}-?\d{4})/g,I=/[^\s@]+@[^\s@.]+\.[^\s@]+/g,O=function(e,t){var n,r;if(void 0===t&&(t=[]),"string"!=typeof e)return"";var i=e;i=(i=(i=i.replace(P,T)).replace(S,T)).replace(I,T);try{for(var o=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),a=o.next();!a.done;a=o.next()){var u=a.value;try{i=i.replace(u,T)}catch(e){}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i},R=function(e){if("undefined"==typeof document||!document.title)return"";var t=document.querySelector("title");return t&&t.hasAttribute("data-amp-mask")?T:e?e(document.title):document.title},x=function(e){var t={};for(var n in e){var r=e[n];r&&(t[n]=r)}return t},A=function(e){var t;void 0===e&&(e={});var n,u=_(),c=void 0,l=!1,d=e.trackOn,f=e.trackHistoryChanges,p=e.eventType,s=void 0===p?"[Amplitude] Page Viewed":p,v=function(e){var t=e;try{t=decodeURI(e)}catch(e){null==c||c.error("Malformed URI sequence: ",e)}return t},y=function(){return i(void 0,void 0,void 0,function(){var e,t,n;return o(this,function(i){switch(i.label){case 0:return e=v("undefined"!=typeof location&&location.href||""),n={event_type:s},t=[{}],[4,$()];case 1:return[2,(n.event_properties=r.apply(void 0,[r.apply(void 0,t.concat([i.sent()])),{"[Amplitude] Page Domain":"undefined"!=typeof location&&location.hostname||"","[Amplitude] Page Location":e,"[Amplitude] Page Path":"undefined"!=typeof location&&v(location.pathname)||"","[Amplitude] Page Title":R(O),"[Amplitude] Page URL":e.split("?")[0]}]),n)]}})})},m=function(){return void 0===d||"function"==typeof d&&d()},g="undefined"!=typeof location?location.href:null,h=function(){return i(void 0,void 0,void 0,function(){var e,n,r,i;return o(this,function(o){switch(o.label){case 0:return e=location.href,n=U(f,e,g||"")&&m(),g=e,n?(null==c||c.log("Tracking page view event"),null!=t?[3,1]:[3,3]):[3,4];case 1:return i=(r=t).track,[4,y()];case 2:i.apply(r,[o.sent()]),o.label=3;case 3:o.label=4;case 4:return[2]}})})},b=function(){h()},w={name:"@amplitude/plugin-page-view-tracking-browser",type:"enrichment",setup:function(e,r){return i(void 0,void 0,void 0,function(){var i,d;return o(this,function(o){switch(o.label){case 0:return t=r,n=e,(c=e.loggerProvider).log("Installing @amplitude/plugin-page-view-tracking-browser"),l=!0,u&&(u.addEventListener("popstate",b),u.history.pushState=new Proxy(u.history.pushState,{apply:function(e,t,n){var r=a(n,3),i=r[0],o=r[1],u=r[2];e.apply(t,[i,o,u]),l&&h()}})),m()?(c.log("Tracking page view event"),d=(i=t).track,[4,y()]):[3,2];case 1:d.apply(i,[o.sent()]),o.label=2;case 2:return[2]}})})},execute:function(e){return i(void 0,void 0,void 0,function(){var t;return o(this,function(i){switch(i.label){case 0:return"attribution"===d&&C(e)?(null==c||c.log("Enriching campaign event to page view event with campaign parameters"),[4,y()]):[3,2];case 1:t=i.sent(),e.event_type=t.event_type,e.event_properties=r(r({},e.event_properties),t.event_properties),i.label=2;case 2:return n&&e.event_type===s&&(n.pageCounter=n.pageCounter?n.pageCounter+1:1,e.event_properties=r(r({},e.event_properties),{"[Amplitude] Page Counter":n.pageCounter})),[2,e]}})})},teardown:function(){return i(void 0,void 0,void 0,function(){return o(this,function(e){return u&&(u.removeEventListener("popstate",b),l=!1),[2]})})}};return w},$=function(){return i(void 0,void 0,void 0,function(){var e;return o(this,function(t){switch(t.label){case 0:return e=x,[4,(new k).parse()];case 1:return[2,e.apply(void 0,[t.sent()])]}})})},C=function(e){if("$identify"===e.event_type&&e.user_properties){var n=e.user_properties,r=n[t.SET]||{},i=n[t.UNSET]||{},o=u(u([],a(Object.keys(r)),!1),a(Object.keys(i)),!1);return Object.keys(b).every(function(e){return o.includes(e)})}return!1},U=function(e,t,n){if("pathOnly"===e){if(""==n)return!0;var r=new URL(t),i=new URL(n);return r.origin+r.pathname!==i.origin+i.pathname}return t!==n};e.pageViewTrackingPlugin=A,e.plugin=A,Object.defineProperty(e,"__esModule",{value:!0})});
